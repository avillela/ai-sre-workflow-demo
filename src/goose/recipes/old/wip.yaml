version: 1.0.0
title: Bootstrap ArgoCD.
description: Bootstrap ArgoCD for use.
instructions: The task includes steps to bootstrap argocd, preparing the environment for use. It includes resetting the argocd password from the initial password, enabling argocd to generate a token, and generating the token itself.

parameters:
  - key: env_file
    input_type: string
    requirement: required
    default: "src/goose/config/.env"
    description: "Env file path (including .env file)"

sub_recipes:
  - name: "port_forward_1"
    path: "./sub_recipes/port-forward.yaml"
    sequential_when_repeated: true
  - name: "cli_install"
    path: "./sub_recipes/argo-cli.yaml"
    values:
      target_directory: "~/.local/bin"
      cli_name: "argocd"
  - name: "password_update"
    path: "./sub_recipes/argo-password-update.yaml"
  - name: "token_config"
    path: "./sub_recipes/argo-api-token-config.yaml"
  - name: "port_forward_2"
    path: "./sub_recipes/port-forward.yaml"
    sequential_when_repeated: true
  - name: "token_gen"
    path: "./sub_recipes/argo-api-token-generation.yaml"
    values:
      env_file: "{{ env_file }}"
      # include_dependencies: "true"

extensions:
- type: builtin
  name: developer
  display_name: Developer Tools
  description: null
  timeout: 300
  bundled: true
  available_tools: []

prompt: |
  Prepare the argocd environment by running the sub-recipes sequentially. Start with the sub-recipe port_forward_1. Run sub-receipe port_forward_2 before running token_gen sub-recipe. Summarize results after each sub-recipe executes, and then summarize overall results.

# settings:
#   goose_provider: github_copilot
#   goose_model: gpt-4o
#   temperature: 0.0
# activities:
# - Log into ArgoCD CLI using environment variables
# - Patch ArgoCD config for account capabilities
# - Generate an ArgoCD API token
# - Validate and restart ArgoCD server
author:
  contact: avillela

