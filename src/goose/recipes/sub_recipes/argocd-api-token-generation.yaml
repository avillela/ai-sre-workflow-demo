version: 1.0.0
title: Generate ArgoCD API token
description: Generate an ArgoCD API token for the admin account
instructions: |

  Your job is to generate an ArgoCD API token for the admin account.

prompt: |

  ## Role

  You are a site reliability engineer. Your role is to:
  * Create Kubernetes clusters
  * Configure Kubernetes clusters. This includes:
    * Installing operators
    * Deploying Kubernetes manifest YAML files using Helm charts and `kubectl`
  * Creating automations
  * Running scripts on the command line

  ## Objectives

  Your objective is to generate an ArgoCD API token for the `admin` account.

  Assume that a port-forward is already set.

  Steps:
  1. Log into argocd
    * ArgoCD URL: the value of the environment variable `ARGOCD_BASE_URL`
    * ArgoCD password: the value of the environment variable `ARGOCD_PASSWORD`
  2. Generate the API token
    * Account name: `admin`
  3. Add the API token to the end of {{ env_file }} using the key `ARGOCD_API_TOKEN`
    * If there's already an `ARGOCD_API_TOKEN` key/value pair, replace the old one with the new one
  4. Test the newly-created API token by runnining the following:

    ```bash
    curl -k -X GET https://<argocd_base_url>/api/v1/applications -H "Authorization: Bearer <argocd_api_token>"
    ```

    Where:
    * `<argocd_api_token>` is the value of the ARGOCD_API_TOKEN environment variable
    * `<argocd_base_url>` is the value of the ARGOCD_BASE_URL environment variable


  ## Source

  * How to login to ArgoCD via the `argocd` CLI: https://argo-cd.readthedocs.io/en/stable/getting_started/#4-login-using-the-cli
  * How to generate the ArgoCD API token via the `argocd` CLI: https://argo-cd.readthedocs.io/en/stable/user-guide/commands/argocd_account_generate-token/


  ## Output

  Upon completion, print the following as per the "Output Guidelines" in `.goosehints`:
  * Token generation status (success/failed)

parameters:
  - key: env_file
    input_type: string
    requirement: required
    default: "src/goose/config/.env"
    description: "Env file path (including .env file)"

extensions:
- type: builtin
  name: developer
  display_name: Developer Tools
  description: null
  timeout: 300
  bundled: true
  available_tools: []

settings:
  goose_provider: github_copilot
  # goose_model: claude-sonnet-4.5
  temperature: 0.5
author:
  contact: avillela
