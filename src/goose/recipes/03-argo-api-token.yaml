version: 1.0.0
title: Generate ArgoCD API token
description: Generate an ArgoCD API token for the admin account
instructions: The task includes steps to enable argocd to generate a token, and generate the token itself.

parameters:
  - key: env_file
    input_type: string
    requirement: required
    default: "src/goose/config/.env"
    description: "Env file path (including .env file)"

sub_recipes:
  - name: "token_config"
    path: "./sub_recipes/argo-api-token-config.yaml"
  - name: "port_forward"
    path: "./sub_recipes/port-forward.yaml"
  - name: "token_gen"
    path: "./sub_recipes/argo-api-token-generation.yaml"
    values:
      env_file: "{{ env_file }}"
      # include_dependencies: "true"


extensions:
- type: builtin
  name: developer
  display_name: Developer Tools
  description: null
  timeout: 300
  bundled: true
  available_tools: []

prompt: |
  Generate an argocd api token by running the sub-recipes sequentially. Run the sub-recipes in this order: token_config, port_forward, token_gen. Summarize results after each sub-recipe executes, and then summarize overall results.

# settings:
#   goose_provider: github_copilot
#   goose_model: gpt-4o
#   temperature: 0.0
# activities:
# - Log into ArgoCD CLI using environment variables
# - Patch ArgoCD config for account capabilities
# - Generate an ArgoCD API token
# - Validate and restart ArgoCD server
author:
  contact: avillela
